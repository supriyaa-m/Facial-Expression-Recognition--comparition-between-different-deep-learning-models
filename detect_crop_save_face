imds = imageDatastore('Final_Data5', ...
    'IncludeSubfolders',true, ...
    'LabelSource','foldernames');
% Total number of images. 
numImages = numel(imds.Labels);
%Creating a folder for processed images.
rootDir = 'FaceDetected';
mkdir(rootDir)
% Total number of subfolders i.e classes.
totFolders = numel(categories(imds.Labels));
foldersNames = categories(imds.Labels);
for n = 1:totFolders
    mkdir(rootDir,foldersNames{n})
end
imds.Labels(1)
count = 1;
j = 1;
for t = 1:numImages    
    I = readimage(imds,t);
    FaceDetect = vision.CascadeObjectDetector; 
    FaceDetect.MergeThreshold = 7;
    BB = step (FaceDetect, I);  
    for i = 1: size (BB, 1)     
      rectangle ( 'Position' , BB (i, :), 'LineWidth' , 3, 'LineStyle' ,...
          '-' , 'EdgeColor' , 'r' );
    end 
    for i = 1: size (BB, 1)
      I = imcrop (I, BB (i, :)); 
      figure (3);
      subplot (6, 6, i);
      imshow (I); 
      j = j + 1;
      %imwrite (I,croppedimg,'jpg' )
    end
    subF = char(imds.Labels(t));
    imageName = [sprintf('%d',count),'.jpg'];
    fullFileName = fullfile(rootDir,subF,imageName);
    
    imwrite(I, fullFileName);
    
    fprintf('Detected %0.2f percent records\n',(i/numImages)*100);
    
    count = count+1;
